<!DOCTYPE html>
@{
    ViewBag.Title = "GeoQuiz";
}
<html>
<head>
    <title>Earth</title>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <script type="text/javascript"
            src="https://www.google.com/jsapi">
    </script>
</head>
<body>
    <div style="width: 100%; overflow: hidden;">
        <div style="height: 50px;"></div>
        <div style="width: 600px; float: left;">
            <div style="height: 300px;">
                <h1 class="text-success" align="center">@ViewBag.Random</h1> <!-- OVDJE IDE DRZAVA IZ BAZE -->
            </div>
            <div style="margin-left: 50px;">
                <h2>Statistika</h2>
                <h4>Bodovi:</h4>
                <h4>Točni odgovori:</h4>
                <h4>Netočni odgovori:</h4>
                <h4>Neodgovorena pitanja:</h4>
            </div>
        </div>
        <div style="margin-left: 620px;">
            <div align="right" id="map3d"
                 style="height: 600px;
              width: 900px;">
                <h2>
                    <script>
                        var drz1 = "@ViewBag.Random";
                        var drz = drz1.replace(/&amp;/g, '&');

                        function Zumiraj(a, b, c) {
                            setLookAt(ge, a, b, c);
                        }


                    </script>
                    <script type="text/javascript">
    var ge;
    google.load("earth", "1",{ "other_params": "sensor=false" });
    google.setOnLoadCallback(init);


    function init() {
        google.earth.createInstance('map3d', initCB, failureCB);

    }

    //inicijaliziranje
    function initCB(instance) {
        ge = instance;
        ge.getWindow().setVisibility(true);
        ge.getLayerRoot().enableLayerById(ge.LAYER_BORDERS , false);

        //loadanje KML-a
        var kmlUrl = 'https://sites.google.com/site/mislavsite/countries_world-kml/doc3.kml?attredirects=0&d=1';
        addKmlFromUrl(kmlUrl);

        function addKmlFromUrl(kmlUrl) {
            google.earth.fetchKml(ge, kmlUrl, kmlFinishedLoading);
        }

        function kmlFinishedLoading(kmlObject) {
            if (kmlObject) {
                ge.getFeatures().appendChild(kmlObject);
            }
        }

        function kmlFinishedLoading(kmlObject) {
            if (kmlObject) {
                // check if the object is a KmlContainer (folder or document)
                if ('getFeatures' in kmlObject) {
                    var firstChild = kmlObject.getFeatures().getFirstChild();
                    if (firstChild !== null) {
                        kmlObject.getFeatures().removeChild(firstChild);
                    }
                }

                ge.getFeatures().appendChild(kmlObject);
            }
        }

        //sprijecanje balona
        google.earth.addEventListener(ge.getGlobe(), 'click', popupPrevent); //sprijecavanje balona nakon klika

        function popupPrevent(event) {
            event.preventDefault();
        }

        //double-click oznacavanje konacnog odgovora (drzave)
        //google.earth.addEventListener(ge.getGlobe(), 'dblclick', popupPrevent);

        //var drz = "@ViewBag.Random";

        google.earth.addEventListener(ge.getGlobe(), 'dblclick', recordEvent); //sprijecavanje balona nakon klika

        function recordEvent(event) {
            event.preventDefault();
            var target = event.getTarget();
            var type = target.getType();
            var boja = target.getStyleSelector().getPolyStyle().getColor();
            if (type == "KmlPlacemark") {
                
                // get the data you want from the target.
                var description = target.getDescription();
                var tocnaDrzava = description.indexOf("=" + drz + "'");  //gdje je Niger ići će varijabla trenutna država koju ćemo izgenerirati

                if (tocnaDrzava == -1) {
                    var boja
                    var a = boja.get(); //uzima trenutnu boju
                    boja.set('EE5C42ff'); //obojaj u crveno
                    setTimeout(function () { boja.set(a) }, 500); //nakon pola sekunde vrati boju koja je bila
                }

                else {
                    target.getStyleSelector().getPolyStyle().getColor().set('ff6d9600');
                }
                //STAVIT METODU UPDATEDISPLAY();

                function vratiBoju() {
                    target.getStyleSelector().getPolyStyle().getColor().set(a);
                }
            }
        }

        google.earth.addEventListener(ge.getWindow(), 'dblclick', function
        (event) {
            event.preventDefault();
        });
    }

//funkcija za podesavanje pogleda na kontinente
    function setLookAt(ge, latitude, longitude, range) {
        var lookAt = ge.createLookAt('');
        lookAt.setLatitude(latitude);
        lookAt.setLongitude(longitude);
        lookAt.setRange(range);
        ge.getView().setAbstractView(lookAt);
    }

    function failureCB(errorCode) {
    }
    google.setOnLoadCallback(init);
        </script>
    </h2>
</div>
<div class="navbar navbar-default" style="width: 900px;">
    <div class="container">
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a onclick="Zumiraj(50.0, 20.0, 4500000.0);" style="cursor: pointer; cursor: hand;">Europe</a></li>
                <li><a onclick="Zumiraj(0.0, 20.0, 9000000.0);" style="cursor: pointer; cursor: hand;">Africa</a></li>
                <li><a onclick="Zumiraj(35.0, 90.0, 9000000.0);" style="cursor: pointer; cursor: hand;">Asia</a></li>
                <li><a onclick="Zumiraj(40.0, -90.0, 9000000.0);" style="cursor: pointer; cursor: hand;">N.America</a></li>
                <li><a onclick="Zumiraj(-20.00, -60.0, 8000000.0);" style="cursor: pointer; cursor: hand;">S.America</a></li>
                <li><a onclick="Zumiraj(-22.0, 140.0, 7500000.0);" style="cursor: pointer; cursor: hand;">Australia</a></li>
                
                <li>                                                                                 </li>
                <li><a onclick="NovaIgra();" style="cursor: pointer; cursor: hand;">New Game</a></li>
            </ul>
        </div>

    </div>
</div>
</div>
</div>
</body>
</html>